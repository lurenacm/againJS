
## CSRF 攻击
> CSRF 攻击(cross-site request forgery)是指，跨站请求伪造。所谓的跨站请求伪造是指，用户在 A网 上，点击了有恶意信息的 B网 页面，那么 B网 就会利用用户在 A网目前的登陆状态发起跨站请求攻击。
 
* 概括：诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求 

### CSRF 攻击的三种方式
#### GET 请求
> 这里的 get 请求是用户登陆 A网 `http://bank.example/withdraw?user=10000&for=hacker` 会在本地留下 cookie 且没有退出 A 网，随后上登陆了恶意网站 B网，点击了 B网上面的一个 GET请求链接，比如一张图片 `<img src="http://bank.example/withdraw?user=10000&for=hacker">`，这个请求携带了用户的 `cookie` 信息，这样 B网 冒充受害者提交操作


#### POST 类型的 CSRF 
> 和 GET 请求一样，恶意网站 B，伪造了一个表单，你填写完后提交，这个 POST 请求照样会携带用户的 cookie，A 网的服务器接收后以为是用户的操作，造成被攻击

#### 链接类型的CSRF
> 这种类型的 CSRF 的攻击是，在 A 网站中的图片，或广告内含有恶意网站的链接，用夸张语句诱导用户点击，造成被攻击。

**CSRF攻击使用了服务器的检验漏洞和用户的登陆状态冒充用户的操作达到攻击的目的**


### CSRF 防止措施
* 利用好 cookie 的 SameSite属性，对携带的 cookie 做限制。
SameSite 的三个值 `strict` 禁止第三方请求携带 cookie，Lax 模式允许 get 请求携带 cookie，None 模式表示不允许任何网站请求会携带 cookie。
* 检验站点来源，使用请求头中的 `Origin 和 Referer`。`Origin` 包含域名信息，`Referer` 包含了具体请求的 URL 路径。
* CSRF token。由服务器生成的 Token 作为客服端和服务器之间通信。


### 双提交cookie
> 利用 CSRF 攻击不能读取 cookie 的特点（因为攻击者不能知道cookie中的键值是什么，攻击者只能携带 cookie），给请求的 url 后面加上一个 cookie 的值
* 在用户登陆页面时，给请求的 域名 后面注入一个 cookie，内容为随机数 `csrfcookie=v8g9e4ksfhw`
* 在前端想后端发送时，取出 cookie，并添加到 URL 的参数中，例如 `https://www.a.com/comment?csrfcookie=v8g9e4ksfhw`
* 后端接口认证 cookie 的字段与 url 字段是否一致，不一致则直接拒绝。


优点：
* 不需要 session。
* 相对于 token，实施成本低，可以在前后端拦截校验，而不需要一个个接口添加。


缺点：
* cookie 添加了额外的字段。
* cookie 如果没有设置 httOnly，攻击者可以注入 cookie，那么防御就没有意义了
* 为了确保从cookie的传输安全行，最好使用 https 这种可靠的传输机制。




## 参考
[前端攻击之CSRF](https://juejin.cn/post/6844903689702866952#heading-14)



