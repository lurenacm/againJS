# Ajaxã€fetchã€axios

> __å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ—ä¸€ä¸€ï¼Œä¸‹é¢è¿™ç¯‡æ–‡ç« æ˜¯å…³äº Ajaxï¼Œfetchï¼Œaxiosçš„è¶…é«˜é¢‘é¢è¯•é¢˜ï¼Œä¸€èµ·æ¥é˜…è¯»å§ğŸ¤—__

## æ€ç»´å¯¼å›¾

![æœªå‘½åæ–‡ä»¶.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9aee627c53f4ec3b837e3bb2cc97431~tplv-k3u1fbpfcp-watermark.image)

# ä¸€ã€Ajax
### 1. æ¦‚å¿µ
>Ajaxå…¨ç§°ï¼šasync javaScript and xmlã€‚xmlï¼šæ˜¯ä¸€ç§å¯ä»¥æ‰©å±•çš„æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥æ‰©å±•è‡ªå®šä¹‰çš„è¯­ä¹‰æ ‡ç­¾ã€‚å¾ˆæ—©ä»¥å‰ xml å¸¸ç”¨äºä»æœåŠ¡ç«¯è¿”å›æ•°æ®ç»“æ„ï¼Œç°åœ¨åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ json æ ¼å¼è¿”å›æ•°æ®ã€‚

### 2. ä½œç”¨
> åœ¨ä¸åˆ·æ–°å…¨å±€çš„æ¡ä»¶ä¸‹ï¼Œå±€éƒ¨åˆ·æ–°é¡µé¢ã€‚

### 3. å››æ­¥åˆ›å»º Ajax
1. åˆ›å»º `Ajax`å®ä¾‹ï¼Œ`let xhr = new XMLHttpRequest()`ï¼ŒIE6 ä¸å…¼å®¹è¿™ç§å†™æ³•
2. æ‰“å¼€è¯·æ±‚ï¼Œé…ç½®è¯·æ±‚å‰çš„é…ç½®é¡¹ï¼Œå…± 5ä¸ªå‚æ•°ï¼Œ`xhr.open([http method], [url], [async], [userName], [userPass])`
    > `http methods` æœ‰å¸¸ç”¨çš„è¯·æ±‚æ–¹å¼æœ‰ï¼Œ`post, get, delete, put, head, options, trace, connect`ã€‚`async`ä»£è¡¨å¼‚æ­¥ï¼Œé»˜è®¤æ˜¯ `true` å¼‚æ­¥ï¼Œ`false` æ˜¯åŒæ­¥ã€‚`[url]`ï¼šæ˜¯æƒ³æœåŠ¡å™¨è¯·æ±‚çš„ `api`ã€‚`[userName], [userPass]`ï¼Œä»£è¡¨ç”¨æˆ·åå’Œå¯†ç 

 - __http methods ç»†åˆ†ï¼šdeleteï¼šåˆ é™¤æœåŠ¡å™¨ç«¯çš„æŸäº›æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æ–‡ä»¶ã€‚putï¼šå‘æœåŠ¡å™¨ä¸Šå­˜æ”¾æŸäº›å†…å®¹ï¼Œä¸€èˆ¬æ˜¯æ–‡ä»¶ï¼Œheadï¼šåªæ˜¯è·å–ä»æœåŠ¡å™¨ç«¯è¿”å›çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œä¸è¦å“åº”ä¸»ä½“çš„å†…å®¹ã€‚optionsï¼šä¸€èˆ¬ç”¨äºå‘æœåŠ¡å™¨å‘é€æ¢æµ‹æ€§è¯·æ±‚ï¼Œçœ‹æ˜¯å¦è¿æ¥æˆåŠŸ__

3. äº‹ä»¶ç›‘å¬ `readystatechange`ï¼Œä¸€èˆ¬ç›‘å¬ ajax çŠ¶æ€ç å‘ç”Ÿæ”¹å˜çš„äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥è·å–æœåŠ¡å™¨è¿”å›çš„å“åº”ä¸»å’Œè¯·æ±‚å¤´ã€‚`xhr.onreadystatechange = function (){}`ï¼Œå¯¹äº`åŒæ­¥`æ‰§è¡Œçš„ Ajax è¯·æ±‚ä»£ç æ­¥éª¤ä¸‰è¦æ”¾åœ¨`send`çš„å‰é¢ã€‚å¦åˆ™æ²¡æœ‰æ„ä¹‰ã€‚
4. å‘é€ ajax è¯·æ±‚ï¼Œajax ä»»åŠ¡å¼€å§‹æ‰§è¡Œã€‚`xhr.send([])`ï¼Œ`XMLHttpRequest.send()` æ–¹æ³•ä¸­å¦‚æœ Ajax è¯·æ±‚æ˜¯å¼‚æ­¥çš„åˆ™è¿™ä¸ªæ–¹æ³•å‘é€è¯·æ±‚åå°±ä¼šè¿”å›ï¼Œå¦‚æœAjaxè¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œé‚£ä¹ˆè¯·æ±‚å¿…é¡»çŸ¥é“å“åº”åæ‰ä¼šè¿”å›ã€‚
> ç¬¬äº”æ­¥ç®—ä¸Šçš„è¯ï¼Œå°±æ˜¯è¯»å–è¿”å›çš„æ•°æ® `xhr.responseText` ã€‚
``` js
// 1. åˆ›å»º XMLHttpRequest å®ä¾‹
let xhr = XMLHttpRequest()
// 2. æ‰“å¼€å’ŒæœåŠ¡å™¨çš„è¿æ¥
xhr.open('get', 'URL')
// 3.å‘é€
xhr.send()
// 4. æ¥æ”¶å˜åŒ–ã€‚
xhr.onreadystatechange = () => {
    if(xhr.readyState == 4 && xhr.status == 200){   // readyState: ajax çŠ¶æ€ï¼Œstatusï¼šhttp è¯·æ±‚çŠ¶æ€
        console.log(xhr.responseText);   //å“åº”ä¸»ä½“
    }
}
```
### 4. Ajax çŠ¶æ€å’Œ HTTP çŠ¶æ€ç 
* Ajax çŠ¶æ€ä¸€å…±æœ‰ 5 ç§ `xhr.readyState`ï¼Œåˆ†åˆ«æ˜¯ `0, 1, 2, 3, 4`
>- çŠ¶æ€ 0ï¼š`unsent`ï¼Œåˆšåˆ›å»ºçš„ `XMLHttpRequest` å®ä¾‹ï¼Œè¿˜æ²¡æœ‰å‘é€ã€‚
>- çŠ¶æ€ 1ï¼šï¼ˆè½½å…¥ï¼‰å·²è°ƒç”¨ `send()` æ–¹æ³•ï¼Œæ­£åœ¨å‘é€è¯·æ±‚ã€‚
>- çŠ¶æ€ 2ï¼šï¼ˆè½½å…¥å®Œæˆï¼‰`send()` æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå·²ç»æ¥æ”¶åˆ°å…¨éƒ¨å“åº”å†…å®¹
>- çŠ¶æ€ 3ï¼š`loading`ï¼Œï¼ˆäº¤äº’ï¼‰æ­£åœ¨è§£æå“åº”å†…å®¹
>- çŠ¶æ€ 4ï¼š`done`ï¼Œè¡¨ç¤ºå“åº”çš„ä¸»ä½“å†…å®¹è§£æå®Œæˆï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è°ƒç”¨äº†

* HTTP å¸¸è§çš„çŠ¶æ€ç ã€‚
>- `2xx`ï¼šè¡¨ç¤ºè¯·æ±‚å·²ç»è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç†è§£ï¼Œè¯·æ¥å—ã€‚å¸¸è§çš„æœ‰ï¼Œ`200` è¡¨ç¤ºokï¼Œè¡¨ç¤ºæœåŠ¡èƒ½å¤Ÿè¿”å›ä¿¡æ¯ã€‚`204` No Content æ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚
>- `3xx`ï¼šä¸€ç±»é‡è¦çš„é«˜é¢‘è€ƒç‚¹ï¼Œ`301`ï¼šè¡¨ç¤ºæ°¸ä¹…è½¬ç§»ï¼Œè¿”å›æ—§åŸŸåä¼šè·³è½¬åˆ°å¿ƒåŸŸåã€‚`302`ï¼šä¸´æ—¶è½¬ç§»ã€‚ä¸€èˆ¬ç”¨äºæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œä½†æœåŠ¡å™¨çš„å¹¶å‘æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†åç»­è®¿é—®çš„ç”¨æˆ·è½¬ç§»åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šå»ã€‚`307`ï¼šè¡¨ç¤ºä¸´æ—¶é‡å®šå‘ã€‚`304`ï¼šè¡¨ç¤ºä¸è®¾ç½®ç¼“å­˜ï¼Œå¯¹äºä¸ç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œä¾‹å¦‚`css/js/htmlæ–‡ä»¶`ï¼ŒæœåŠ¡å™¨ä¼šç»“åˆå®¢æˆ·ç«¯è®¾ç½®`304`çŠ¶æ€ï¼ŒåŠ è½½è¿‡çš„èµ„æºä¸‹æ¬¡è¯·æ±‚æ—¶ä¼šåœ¨å®¢æˆ·ç«¯ä¸­è·å–ã€‚
>- `4xx`ï¼šè¡¨ç¤ºè¯­ä¹‰æœ‰è¯¯ï¼Œè¯·æ±‚æ— æ³•è¢«æœåŠ¡å™¨ç«¯ç†è§£ã€‚`400`ï¼šè¡¨ç¤ºè¯·æ±‚çš„å‚æ•°é”™è¯¯ã€‚`401`ï¼šè¡¨ç¤ºæ— æƒé™è®¿é—®ã€‚`404`ï¼šè¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚`413`ï¼šè¡¨ç¤ºå’ŒæœåŠ¡å™¨çš„äº¤äº’è¿‡å¤§ã€‚
>- `5xx`ï¼šæœåŠ¡å™¨ç«¯å‡ºé”™ã€‚`500`ï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯å‡ºç°æœªçŸ¥çš„é”™è¯¯ã€‚`503`ï¼šæœåŠ¡å™¨è¶…è´Ÿè·ã€‚

### 5. ajax ä¸­å¸¸ç”¨çš„å±æ€§å’Œæ–¹æ³•
>1. `onabort`: è¡¨ç¤ºè¯·æ±‚ä¸­æ–­åè¦å¤„ç†çš„äº‹ã€‚å’Œ `xhr.abort()` ä¸€èµ·ä½¿ç”¨ã€‚
>2. `ontimeout`: è¡¨ç¤ºè¯·æ±‚çš„è¶…æ—¶ï¼Œæ‰§è¡Œçš„æ–¹æ³•ã€‚å’Œ`timeout`è®¾å®šçš„äº‹ä»¶ä¸€èµ·ä½¿ç”¨ã€‚
> 3. `response`: å“åº”çš„ä¸»ä½“å†…å®¹ã€‚
>4. `responseText`: å“åº”çš„å…·ä½“å†…å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬æ˜¯ json å­—ç¬¦ä¸²
>5. `responseXML`: å“åº”çš„å…·ä½“å†…å®¹æ˜¯æ–‡æ¡£ã€‚
>6. `status`: http çš„çŠ¶æ€ç ã€‚
>7. `statusText`: çŠ¶æ€ç æè¿°
>8. `withCredentials`ï¼šè¡¨ç¤ºæ˜¯å¦å…è®¸è·¨åŸŸã€‚
>9. `getAllResponseHeaders`ï¼šè·å–æ‰€æœ‰å“åº”å¤´ä¿¡æ¯ã€‚
>10. `xhr.open()`ï¼šæ‰“å¼€URLè¯·æ±‚ã€‚
>11. `xhr.send()`ï¼šè¡¨ç¤ºå‘é€ ajaxã€‚
>12. `setRequestHeader()`: è®¾ç½®è¯·æ±‚å¤´ã€‚è¿™ä¸ªå±æ€§åœ¨å¿…é¡»åœ¨`xhr.open()`åé¢ã€‚

#### æ€è€ƒ
1. `post` å’Œ `get` æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
>`http` çš„æ‰€æœ‰è¯·æ±‚æ–¹æ³•ä¸­éƒ½å¯ä»¥ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå’Œä¼ é€’å†…å®¹ã€‚`get`ï¼šä¸»è¦æ˜¯ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚`post` ä¸»è¦å‘é€æ•°æ®ç»™æœåŠ¡å™¨ã€‚
 `GET` å’Œ `POST` æœ¬è´¨ä¸Šå°±æ˜¯ `TCP` é“¾æ¥ï¼Œå¹¶æ— å·®åˆ«ï¼Œä½†æ˜¯ç”±äºHTTPçš„è§„å®šå’Œæµè§ˆå™¨/æœåŠ¡å™¨çš„é™åˆ¶å…·ä½“ç”±å¦‚ä¸‹çš„åŒºåˆ«
* ä»`ç¼“å­˜`çš„è§’åº¦ä¸Šè¯´ï¼Œ`get` è¯·æ±‚ä¼šè¢«æµè§ˆå™¨é»˜è®¤ç¼“å­˜ä¸‹æ¥ï¼Œè€Œ `post` è¯·æ±‚é»˜è®¤ä¸ä¼šã€‚
* ä»`å‚æ•°`æ¥è¯´ï¼Œ`get` è¯·æ±‚çš„å‚æ•°ä¸€èˆ¬æ”¾åœ¨ `url` ä¸­ï¼Œ`post` è¯·æ±‚æ˜¯æ”¾åœ¨è¯·æ±‚ä¸»ä½“ä¸­ï¼Œå› æ­¤`post`è¯·æ±‚æ›´å®‰å…¨ä¸€äº›ã€‚
* ä» `TCP` ä¸Šæ¥è¯´ï¼Œ`GET` äº§ç”Ÿä¸€ä¸ª `TCP` æ•°æ®åŒ…ï¼›`POST` äº§ç”Ÿä¸¤ä¸ª `TCP` æ•°æ®åŒ…ã€‚å¯¹äºGETæ–¹å¼çš„è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šæŠŠ`http header`å’Œ`data`ä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”200ï¼ˆè¿”å›æ•°æ®ï¼‰ï¼›è€Œå¯¹äº`POST`ï¼Œæµè§ˆå™¨å…ˆå‘é€`header`ï¼ŒæœåŠ¡å™¨å“åº” `100 continue`ï¼Œæµè§ˆå™¨å†å‘é€`data`ï¼ŒæœåŠ¡å™¨å“åº”200 okï¼ˆè¿”å›æ•°æ®ï¼‰ã€‚è™½ç„¶ post è¯·æ±‚éœ€è¦å‘é€ä¸¤æ¬¡ï¼Œä½†æ˜¯æ—¶é—´ä¸Šæ˜¯åŸºæœ¬å·®åˆ«ä¸å¤§çš„ã€‚è¿˜æœ‰å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šåœ¨POSTä¸­å‘é€ä¸¤æ¬¡åŒ…ï¼Œ`Firefox å°±åªå‘é€ä¸€æ¬¡`


1. æ¥ä¸€é“æ€è€ƒé¢˜ï¼Œæ±‚è¾“å‡ºç»“æœ
``` js
let xhr = new XMLHttpRequest()
xhr.open('post', 'api')
xhr.onreadystatechange = () =>{
    if(xhr.readyState == 2){
        console.log(2)
    }
    if(xhr.readyState == 4){
        console.log(4)
    }
}
xhr.send()
console.log(3)
/* è¾“å‡º
*   3 2 4
*/
```
> å¦‚æœçŸ¥é“ä»»åŠ¡é˜Ÿåˆ—çš„æ¦‚å¿µï¼Œä¸éš¾çŸ¥é“è¾“å‡ºçš„ç»“æœï¼Œå› ä¸ºæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥åŒæ­¥çš„ä¸»ä»»åŠ¡å…ˆè¾“å‡º`3`ï¼Œæœ€åè¾“å‡º `2, 4`ã€‚å¦‚æœä¸Šé¢`xhr.open('post', 'api')` å˜æˆ `xhr.open('post', 'api', false)` åä»£ç å°±æ˜¯åŒæ­¥çš„ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­åªæœ‰ä¸»ä»»åŠ¡è¾“å‡ºçš„ç»“æœå˜æˆ`2, 4, 3`ã€‚

2. å†æ¥ä¸€é“æ€è€ƒé¢˜ï¼Œåœ¨åŒæ­¥è¯·æ±‚ä¸­ä¸‹é¢ä»£ç è¾“å‡ºçš„æ˜¯ä»€ä¹ˆ
``` js
let xhr = new XMLHttpRequest()
xhr.open('get', 'xxx', false)
xhr.send()

xhr.onreadystatechange = () => {
    console.log(xhr.readyState)
}
```
> ä¸Šé¢çš„ç»“æœä»€ä¹ˆä¹Ÿæ²¡æœ‰è¾“å‡ºï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä»»åŠ¡é˜Ÿåˆ—çš„çŸ¥è¯†ï¼Œ`onreadystatechange` è¿™ä¸ªäº‹ä»¶ç›‘å¬çš„æ˜¯ ajax çŠ¶æ€ç çš„å˜åŒ–ï¼Œä¸Šé¢çš„åŒæ­¥è¯·æ±‚ä¸­ `xhr.send()` å·²ç»æ‰§è¡Œå®Œå ajax çš„çŠ¶æ€ç ç”± 0 å˜æˆäº† 4 è¿˜æ²¡æœ‰æ‰§è¡Œåˆ° `onreadystatechange` è¿™ä¸ªç›‘å¬äº‹ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰è¾“å‡ºç»“æœã€‚å¦‚æœå°†ç›‘å¬äº‹ä»¶æ”¾åœ¨ `xhr.send()` ä¹‹å‰ï¼Œé‚£ä¹ˆè¾“å‡ºçš„å°±æ˜¯ 4ã€‚

# äºŒã€axios
> `axios` æ˜¯ä½¿ç”¨ `promise` å°è£…çš„ `ajax`ã€‚axios ä¸æ˜¯ä¸€ä¸ªç±»æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚

## 1.  axios å±æ€§
> axios æœ‰ `get, post, put, patch ,delete` ç­‰è¯·æ±‚æ–¹å¼ï¼Œ`getï¼Œpost` è¿”å›çš„å®ä¾‹éƒ½æ˜¯ `promise`ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ `promise` çš„æ–¹æ³•ï¼Œä¸‹é¢ç»™å‡ºåŸºæœ¬çš„å®ç”¨æ–¹æ³•ã€‚
* `axios.get()`ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª `get` è¯·æ±‚ã€‚
``` js
axios.get('apiURL', {
    param: {
        id: 1
    }
}).then(res=>{
    console.log(res);
})
.catch( error=>{
    console.log(error)
}
```
> `param` ä¸­çš„çš„é”®å€¼å¯¹æœ€ç»ˆä¼š `?` çš„å½¢å¼ï¼Œæ‹¼æ¥åˆ°è¯·æ±‚çš„é“¾æ¥ä¸Šï¼Œå‘é€åˆ°æœåŠ¡å™¨ã€‚
* `axios.post()`ç¤ºä¾‹
``` js
axios.post('apiURL',{
        user: 'æ—ä¸€ä¸€',
        age: 18
}).then( res=>{
    console.log(res);
})
.catch( error=>{
    console.log(error)
}
```
* `axios.put()`ç¤ºä¾‹
``` js
axios.put('apiURL', {
    name: 'æ—ä¸€ä¸€',
})
```
* `axios.patch(url[, data[, config]])`ç¤ºä¾‹
``` js
axios.patch('apiURL', {
    id: 13,
},{
   timeout: 1000,
})
```
* `axios.delete()`ç¤ºä¾‹
``` js
axios.delete('apiURL', {
    params: {
        id: 1
    },s
    timeout: 1000
})
```
## 2. ä¸€æ¬¡å¹¶å‘çš„è¯·æ±‚ `axios.all([])`
> `axios.all()` å¯ä»¥å®ç°å¤šä¸ªè¯·æ±‚ï¼Œä¸”è¯·æ±‚éƒ½éœ€è¦åœ¨å®Œæˆåæ‰å†å»åšæŸäº‹ã€‚
``` js
let requestArr = [axios.get('apiURL/1'), axios.get('apiURL/2'), axios.post('apiURL/3', {id: 3})]
axios.all(requestArr).then(res => {
    console.log(res)
})
```
### æ€è€ƒï¼Œaxios.all() æ˜¯æ€ä¹ˆå®ç°å¹¶å‘è¯·æ±‚çš„ï¼Ÿ
> `axios.all()` ä½¿ç”¨çš„æ˜¯ `promise.all()` å®ç°çš„ï¼Œæ¥çœ‹çœ‹ axios ä¸­çš„æºç 
``` js
axios.all = function all(promises) {
    return Promise.all(promises);
};
```
## 3. axios ä¸­çš„é…ç½®é¡¹ã€‚
> å®ç”¨çš„ [axiosé…ç½®é¡¹](http://www.axios-js.com/zh-cn/docs/index.html#%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC)

# ä¸‰ã€fetch
## 1. ä»‹ç» fetch
*  `fetch`ï¼šæ˜¯ `http` çš„æ•°æ®è¯·æ±‚æ–¹å¼ï¼Œæ˜¯ `XMLHttpRequest` çš„ä¸€ç§ä»£æ›¿æ–¹æ¡ˆï¼Œæ²¡æœ‰ä½¿ç”¨åˆ° `XMLHttpRequest` è¿™ä¸ªç±»ã€‚`fetch` ä¸æ˜¯ ajaxï¼Œè€Œæ˜¯åŸç”Ÿçš„ jsã€‚`fetch()` ä½¿ç”¨ `Promise`ï¼Œä¸ä½¿ç”¨å›è°ƒå‡½æ•°ã€‚`fetch` æ˜¯ ES8 ä¸­æ–°å¢çš„ apiï¼Œå…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ï¼ŒIE å®Œå…¨ä¸å…¼å®¹ `fetch` å†™æ³•ã€‚
* `fetch()` é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒAPI åˆ†æ•£åœ¨ `Response` å¯¹è±¡ã€`Request` å¯¹è±¡ã€`Headers` å¯¹è±¡ä¸Šã€‚
*  `fetch()` é€šè¿‡æ•°æ®æµï¼ˆStream å¯¹è±¡ï¼‰å¤„ç†æ•°æ®ï¼Œå¯¹äºè¯·æ±‚å¤§æ–‡ä»¶æˆ–è€…ç½‘é€Ÿæ…¢çš„åœºæ™¯ç›¸å½“æœ‰ç”¨ã€‚`XMLHttpRequest` æ²¡æœ‰ä½¿ç”¨æ•°æ®æµï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å¿…é¡»å®Œæˆåæ‰æ‹¿åˆ°
*  åœ¨é»˜è®¤æƒ…å†µä¸‹ `fetch` ä¸ä¼šæ¥å—æˆ–è€…å‘é€ `cookies`

## 2. fetch(url, optionObj) åŸºæœ¬ä½¿ç”¨
* æ¥æ”¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¯·æ±‚çš„ `url`ï¼Œé»˜è®¤çš„è¯·æ±‚æ–¹å¼æ˜¯ `get`ã€‚
* ç¬¬äºŒä¸ªæ˜¯å¯é€‰å‚æ•° `optionObj`ï¼Œå¯ä»¥æ§åˆ¶ä¸åŒé…ç½®çš„å±æ€§ï¼Œæ¯”å¦‚ `methodï¼š`å±æ€§æ˜¯å­—ç¬¦ä¸²ã€‚` headers`: ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è®¾å®š http çš„è¯·æ±‚å¤´ã€‚`body`: `POST` è¯·æ±‚çš„æ•°æ®ä½“ï¼Œå±æ€§ä¹Ÿæ˜¯å­—ç¬¦ä¸²ã€‚`credentials` è¡¨ç¤ºæ˜¯å¦å¯ä»¥æºå¸¦ `cookie`ï¼Œ`includes`è¡¨ç¤ºæ˜¯å¦åŒæºéƒ½åŒ…å« `cookie`ã€‚
* `fetch` å‚æ•°æ²¡æœ‰åŒæ­¥çš„è®¾å®šï¼Œå› ä¸º `fetch` æ˜¯åŸºäº  `promise` å°è£…çš„æœ¬èº«å°±æ˜¯å¼‚æ­¥ã€‚
* `fetch` è™½ç„¶ä½¿ç”¨çš„æ˜¯ `promise` å°è£…çš„ï¼Œä½†æ˜¯ `catch` å‡½æ•°ä¸èƒ½ç›´æ¥çš„æ•è·åˆ°é”™è¯¯ï¼Œéœ€è¦åœ¨ç¬¬ä¸€ä¸ª `then` å‡½æ•°å†…åšäº›æ“ä½œã€‚
> `fetch` å‘é€ postè¯·æ±‚æ—¶ï¼Œå½“å‘ç”Ÿçš„æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œ`fetch` ä¼šå…ˆå‘é€ä¸€ä¸ª `OPTIONS` è¯·æ±‚ï¼Œæ¥ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å…è®¸æ¥å—è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¸»è¦æ˜¯ç”¨æ¥è¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸ä¿®æ”¹headerå¤´ç­‰ä¸€äº›æ“ä½œã€‚æœåŠ¡å™¨åŒæ„åè¿”å› 204ï¼Œæ‰ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚ã€‚æ²¡æœ‰å‘ç”Ÿè·¨åŸŸçš„æƒ…å†µä¸‹ä¸ä¼šäº§ç”Ÿä¸¤æ¬¡è¯·æ±‚ã€‚

__ä¸€ä¸ª get è¯·æ±‚__
``` js
const pro = fetch('https://lyypro.gitee.io/blog/')
pro.then( response => 
    response.json()
).catch( err => {
    console.log(err)
})
```
__ä¸€ä¸ª post è¯·æ±‚__
``` js
const URL =  'https://lyypro.gitee.io/blog/'
const init = {
    method: 'POST',
    header: {
        "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
    },
    data: 'id=12&name=æ—ä¸€ä¸€',
    credentials: 'include'
}
const pro = fetch(URL, init)
pro.then( response => 
    response.json()
).catch( err => {
    console.log(err)
})
```
> ä¸Šé¢çš„è¯·æ±‚éƒ½å¯ä»¥ä½¿ç”¨ `await, async` æ¥ä¿®æ”¹è¿™é‡Œä¸å±•ç¤ºã€‚åŒæ—¶æ˜¯ä¸º `post` è¯·æ±‚ä¸­ï¼Œ`data` å±æ€§åªæ”¯æŒå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨

## 4. fetch çš„ä¸‰ä¸ªæ¨¡å—
* `Response` æ¨¡å—ï¼š`fetch` è¯·æ±‚å‘é€åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªæœåŠ¡å™¨çš„å“åº” `response`ï¼Œè¿™ä¸ªå“åº”å¯¹äºç€ http çš„å›åº”ã€‚
* `Request` æ¨¡å—ï¼šè¿™æ˜¯ç”¨äºè¯·æ±‚æœåŠ¡å™¨çš„æ¨¡å—ï¼Œä¸Šé¢æåˆ°çš„ `data, header, method` éƒ½æ˜¯ `Request` æ¨¡å—çš„å±æ€§ã€‚
* `Headers`ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ `Response.headers`ä¸Šçš„å±æ€§ç”¨äºæ“æ§å“åº”å¤´çš„ä¿¡æ¯ã€‚
> ä¸Šé¢ä¸‰è€…çš„è¯¦ç»†å±æ€§å¯ä»¥çœ‹çœ‹ [é˜®è€å¸ˆçš„ Fetch API æ•™ç¨‹](http://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html)

## 5.æ€è€ƒ å‘é€ post 2 æ¬¡è¯·æ±‚çš„åŸå› 
> ä½¿ç”¨ `fetch` å‘é€ `post` è¯·æ±‚æ—¶å¦‚æœæ˜¯è·¨åŸŸï¼Œé‚£ä¹ˆå¯¼è‡´ `fetch` ç¬¬ä¸€æ¬¡å‘é€äº†ä¸€ä¸ª`Options` è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ”¯æŒä¿®æ”¹çš„è¯·æ±‚å¤´ï¼Œå¦‚æœæœåŠ¡å™¨æ”¯æŒï¼Œåˆ™åœ¨ç¬¬äºŒæ¬¡ä¸­å‘é€çœŸæ­£çš„è¯·æ±‚ã€‚

## 6.æ€è€ƒ fetch  çš„ç¼ºç‚¹
> 1. `fetch` çš„ `get/head` è¯·æ±‚ä¸èƒ½è®¾ç½® `body` å±æ€§ã€‚
> 2. `fetch` è¯·æ±‚åï¼ŒæœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç æ— è®ºæ˜¯å¤šå°‘åŒ…æ‹¬(4xx, 5xx)ï¼Œ`fetch` éƒ½ä¸è®¤ä¸ºæ˜¯å¤±è´¥çš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ `catch` ä¹Ÿä¸èƒ½ç›´æ¥æ•æ‰åˆ°é”™è¯¯ï¼Œéœ€è¦å†ç¬¬ä¸€ä¸ª `then` ä¸­åšä¸€äº›å¤„ç†ã€‚

## å››ã€é¢è¯•é¢˜
> å°è£…åŸç”Ÿçš„ Ajax
### 1.å®ç°ä¸€ä¸ª Ajaxã€‚
> å°†åŸç”Ÿçš„ ajax å°è£…æˆ promise
``` js
var myNewAjax = function (url) {
    return new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open('get', url);
        xhr.send(data);
        xhr.onreadystatechange = function () {
            if (xhr.status == 200 && readyState == 4) {
                var json = JSON.parse(xhr.responseText);
                resolve(json)
            } else if (xhr.readyState == 4 && xhr.status != 200) {
                reject('error');
            }
        }
    })
}
```
### 2. ajax æœ‰å‡ ä¸ªçŠ¶æ€ï¼Œåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ
> ajax 5ä¸ªçŠ¶æ€å‘ä¸Šçœ‹ã€‚

### 3. fetch VS ajax VS axios åŒºåˆ«
* ä¼ ç»Ÿçš„ `ajax` åˆ©ç”¨çš„æ˜¯ `XMLHttpRequest` è¿™ä¸ªå¯¹è±¡ï¼Œå’Œåç«¯è¿›è¡Œäº¤äº’ã€‚`JQuery ajax` æ˜¯å¯¹åŸç”Ÿ `XHR` çš„å°è£…ï¼Œå¤šè¯·æ±‚é—´æœ‰ç­¾åˆ°çš„è¯å°±ä¼šå‡ºç°å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚
* `axios` ä½¿ç”¨ `promise` å°è£… `xhr`ï¼Œè§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜
* `fetch` ä¸æ˜¯ `XMLHttpRequest`ï¼Œ`fetch` æ˜¯åŸç”Ÿçš„ jsï¼Œä½¿ç”¨çš„æ˜¯ `promise`ã€‚

### 4. Fetch å’Œ Ajax æ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ
> fetch ä½¿ç”¨çš„æ˜¯ promise æ–¹ä¾¿ä½¿ç”¨å¼‚æ­¥ï¼Œæ²¡æœ‰å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚

### 5. å¦‚ä½•å®ç°ä¸€ä¸ª ajax è¯·æ±‚ï¼Ÿå¦‚æœæˆ‘æƒ³å‘å‡ºä¸¤ä¸ªæœ‰é¡ºåºçš„ ajax éœ€è¦æ€ä¹ˆåšï¼Ÿ
> å®ç° ajax çš„è¯·æ±‚å°±æ˜¯ä¸Šé¢çš„åˆ›å»º ajax çš„é€¼æ ¼æ­¥éª¤ã€‚å®ç°ä¸¤ä¸ªæœ‰é¡ºåºçš„ ajax å¯ä»¥ä½¿ç”¨ `promise.then()`

### 6. Ajax æ€ä¹ˆè§£å†³æµè§ˆå™¨ç¼“å­˜é—®é¢˜
* è®¾ç½®è¯·æ±‚å¤´ï¼Œåœ¨ ajax å‘é€è¯·æ±‚å‰åŠ ä¸Š `anyAjaxObj.setRequestHeader("If-Modified-Since","0")` æˆ– `anyAjaxObj.setRequestHeader("Cache-Control","no-cache")`ã€‚
* åœ¨ URL åé¢åŠ ä¸Šä¸€ä¸ªéšæœºæ•°ï¼š` "fresh=" + Math.random()`ã€‚ æˆ–åœ¨åé¢åŠ ä¸Šæ—¶é—´æ“ï¼š`"nowtTime=" + new Date().getTime()`ã€‚
* å¦‚æœæ˜¯ä½¿ç”¨ jQueryï¼Œç›´æ¥è¿™æ ·å°±å¯ä»¥äº† `$.ajaxSetup({cache:false})`ã€‚è¿™æ ·é¡µTé¢çš„æ‰€æœ‰ ajax éƒ½ä¼šæ‰§è¡Œè¿™æ¡è¯­å¥å°±æ˜¯ä¸éœ€è¦ä¿å­˜ç¼“å­˜è®°å½•ã€‚

### 7.å®ç° Ajax å¹¶è¡Œè¯·æ±‚
* ä¸²è¡Œï¼šè¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”éœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªæ‰§è¡Œå®Œæˆæ‰å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚
* å¹¶è¡Œï¼šåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œ`Http`çš„è¯·æ±‚å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªï¼ŒJS ä¼šä¸€æ­¥æ­¥å¤„ç†è¯·æ±‚ï¼Œç­‰åˆ°åŒæ—¶å‘é€çš„è¯·æ±‚éƒ½æˆåŠŸäº†ï¼Œå†å»åšå…¶ä»–äº‹ã€‚
> åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚æˆ‘ä»¬éœ€è¦å®ç°ç¡®ä¿ç”¨æˆ·ç™»é™†æˆåŠŸåï¼Œå†è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå†æä¾›ç›¸åº”çš„æ´»åŠ¨è®°å½•ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Promise.all()` å®ç°ï¼Œå¦‚æœä½¿ç”¨ `Jquery` å¯æ˜¯ä¼šå¯¼è‡´å›è°ƒåœ°ç‹±ã€‚
``` js
let p1 = axios.get('xx1')
let p2 = axios.get('xx2')
let p3 = axios.get('xx3')

Promise.all([p1, p2, p3])
    .then( res => {
        console.log(res)
    }).catch( err => {
        console.log(err)
    })
```


# äº”ã€å‚è€ƒ
[getå’Œpostçš„åŒºåˆ«](https://www.oschina.net/news/77354/http-get-post-different)

[Fetch API æ•™ç¨‹](http://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html)

[MDN XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)

[MDN fetch](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch)

# å…­ã€ç»“æŸ
> __æ„Ÿè°¢é˜…è¯»åˆ°è¿™é‡Œï¼Œå¦‚æœç€ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰ä¸€ç‚¹å¯å‘æˆ–å¸®åŠ©çš„è¯æ¬¢è¿ [star](https://github.com/lurenacm/againJS/issues), æˆ‘æ˜¯æ—ä¸€ä¸€,ä¸‹æ¬¡è§ã€‚__



