## 一、JS异步编程基本概念
> JS 之所以是单线程的是因为浏览器(多线程)只分配一个线程来执行 JS 代码

### 进程和线程
> 进程中可以包括多个线程，比如打开一个页面，这个页面就占用了计算机的一个进程，页面加载时，浏览会分配一个线程去计算DOM树，一个去执行 JS 代码，其他的线程去加载资源文件等。

## 二、宏任务和微任务
### 1. 宏任务
>  s

### 2. 微任务
> w

__先看一个小栗子__
``` js
// A 任务
setTimeout(() => {
    console.log(1)
}, 20)

// B 任务
setTimeout(() => {
    console.log(2)
}, 0)

// C 任务
setTimeout(() => {
    console.log(3)
}, 10)

// D
setTimeout(() => {
    console.log(5)
}, 10)

console.log(4)
/* 输出
*   4 -> 2-> 3 -> 5 -> 1
*/
```
[任务队列图解](./img/任务队列.jpg)
> 在主线程也就是主任务中，上面的代码自上而下执行，`setTimeout` 代码都是异步的。所以都会被加入到等待队列中，浏览器有专门监听等待队列中的代码，`在主栈中的同步代码执行完成后，等待队列中的任务先到执行时间的就先执行，如果等待任务队列中有两个同时到执行时间的异步代码，那么先入队列的就先到主栈中执行`。所以等待队列中 B 任务执行后到 C 任务到 D 任务 再到 A 任务。输出的结果就是`4 -> 2-> 3 -> 1`。

__将上面的栗子改一下__
``` js
// A 任务
setTimeout(() => {
    console.log(1)
}, 20)

// B 任务
setTimeout(() => {
    console.log(2)
}, 0)

// C 任务
setTimeout(() => {
    console.log(3)
}, 30)

console.log(4)
/* 输出
*   4 -> 2-> 1 -> 3
*/
```
> 这题的原理和上面一样，任务A 的执行时间比 C 任务先到了就先输出了 1 后输出 3。




## 思考题求输出
### 1. 来一道思考题，求输出结果
``` js
let xhr = new XMLHttpRequest()
xhr.open('post', 'api')
xhr.onreadystatechange = () =>{
    if(xhr.readyState == 2){
        console.log(2)
    }
    if(xhr.readyState == 4){
        console.log(4)
    }
}
xhr.send()
console.log(3)
/* 输出
*   3 2 4
*/
```
### 2. 再来一道思考题，在同步请求中下面代码输出的是什么
``` js
let xhr = new XMLHttpRequest()
xhr.open('get', 'xxx', false)
xhr.send()

xhr.onreadystatechange = () => {
    console.log(xhr.readyState)
}
```
> 没有输出，上面的两道题在 [面试 | Ajax，fetch，axios的超高频面试题]() 有解析。
### 3. 一道 Ajax 异步思考题，求输出结果。
``` js
let xhr = new XMLHttpRequest()
xhr.open('post', 'api')
xhr.onreadystatechange = () =>{
    console.log(xhr.readyState)
}
xhr.send()
/* 输出
*   2 -> 3 -> 4。
*/
```
>`xhr.onreadystatechange` 是异步的会加入到等待队列，主任务执行 `xhr.send()` 后 ajax 的状态码变成 `1`。主任务空闲等待任务中的 `xhr.onreadystatechange` 开始监听到状态码变化，知道状态码由`2 -> 3 -> 4` 后不再变化。如果不熟悉 ajax 状态码的可以看看 [面试 | Ajax，fetch，axios的超高频面试题]()。

### 4. promise 热身题，求输出结果
``` js
console.log(1)
new Promise((resolve, reject) => {
    console.log(2)
    resolve()
}).then(res => {
    console.log(3)
})
console.log(4)
/* 输出
* 1 -> 2 -> 4 ->3 
*/
```

## 结束
>__js 异步队列的题目就先到这里，如果觉得不过瘾的可以看看这篇文章的[面试 | JS 你不得不懂的 异步编程 | promise 篇超高频面试题]()面试题__