> å‰è¨€ï¼šthis æ˜¯ JS ä¸­ä¸€ä¸ªç‰¹åˆ«é‡è¦çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œthis éš¾å—ï¼Ÿå¥½åƒæŒºç®€å•çš„ã€‚çœ‹å®Œä¸‹é¢è¿™ä¸€ç¯‡æ–‡ç« ï¼Œè¿˜ä¸ä¼šçš„è¯ï¼Œä½ åˆ«æ¥æ‰¾æˆ‘ã€‚æ‰‹åŠ¨ç‹—å¤´ğŸ•ã€‚

## æ€ç»´å¯¼å›¾
[this æ€ç»´å¯¼å›¾](./img/thissiwei.png)

## this çš„æŒ‡å‘
* __æ‰§è¡Œå‡½æ•°å‰æœ‰ `'.'` ç‚¹æ“ä½œç¬¦çš„è¯ï¼Œå‡½æ•°ä½“ä¸­çš„ `this` å°±æŒ‡å‘å‰é¢çš„å¯¹è±¡ï¼Œæ²¡æœ‰å°±æŒ‡å‘ `window`ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘ `undefined`ã€‚è¿™å¥è¯ç‰¹åˆ«çš„é‡è¦ï¼Œè¯·è®°ä½__
* å‡½æ•°æ²¡æœ‰ç›´æ¥è°ƒç”¨è€… `this` æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­æ˜¯windowï¼Œnodeä¸­æ˜¯ global)ã€‚å¦‚åŒ¿åå‡½æ•°ç­‰
* æ„é€ å‡½æ•°çš„ `this` æŒ‡å‘å®ä¾‹æœ¬èº«ã€‚
* ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰`this`çš„ï¼Œç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘æœ€è¿‘çš„éç®­å¤´å‡½æ•° `this`ï¼Œæ‰¾ä¸åˆ°å°±æŒ‡å‘ `window`ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘ `undefined`ã€‚

>__å†æ¥çœ‹ä¸€ä¸‹è¿™å¥è¯ï¼šæ‰§è¡Œå‡½æ•°å‰æœ‰ `'.'` ç‚¹æ“ä½œç¬¦çš„è¯ï¼Œå‡½æ•°ä½“ä¸­çš„ `this` å°±æŒ‡å‘å‰é¢çš„å¯¹è±¡ï¼Œæ²¡æœ‰å°±æŒ‡å‘ `window`__

### ä¸€ã€æ™®é€šå‡½æ•° this çš„çƒ­èº«é¢˜
#### çƒ­èº«é¢˜ 1
``` js
var name = 'æ—ä¸€ä¸€'
function fn(){
    var name = 'æ—äºŒäºŒ'
    return this.name
}
fn()    // æ—ä¸€ä¸€
```
>æ‰§è¡Œå‡½æ•° `fn()`ï¼Œå‰é¢æ²¡æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `window`ã€‚è¾“å‡ºçš„å°±æ˜¯å…¨å±€ä¸‹çš„ `name = 'æ—ä¸€ä¸€'`ã€‚

__å†æ¥çœ‹ä¸€ä¸‹è¿™å¥è¯ï¼šæ‰§è¡Œå‡½æ•°å‰æœ‰ `'.'` ç‚¹æ“ä½œç¬¦çš„è¯ï¼Œå‡½æ•°ä½“ä¸­çš„ `this` å°±æŒ‡å‘å‰é¢çš„å¯¹è±¡ï¼Œæ²¡æœ‰å°±æŒ‡å‘ `window`__

#### çƒ­èº«é¢˜ 2
``` js
var name = 'æ—äºŒäºŒ'
var obj = {
    name: 'æ—ä¸€ä¸€',
    fn: function () {
        return this.name
    }
}
console.log(obj.fn())   // 'æ—ä¸€ä¸€'
var fo = obj.fn
console.log(fo())       // 'æ—ä¸€ä¸€'     fo() ==> window.fo()
```
> `obj.fn()` ä¸­å‡½æ•° `fn()` å‰é¢æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `obj` è¿™ä¸ªå¯¹è±¡ã€‚å†çœ‹æ‰§è¡Œå‡½æ•° `fo()`ï¼Œå‰é¢æ²¡æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `window`ã€‚å…¶å®ä¸Šé¢çš„å‡½æ•° `fo() ==> window.fo()`ï¼Œæ‰€ä»¥æ‰§è¡Œå‡½æ•° `fo()` å‰é¢ä¹Ÿæ˜¯å¯ä»¥çœ‹ä½œæ˜¯æœ‰ `'.'` æ“ä½œç¬¦çš„ã€‚

__å†æ¥çœ‹ä¸€ä¸‹è¿™å¥è¯ï¼šæ‰§è¡Œå‡½æ•°å‰æœ‰ `'.'` ç‚¹æ“ä½œç¬¦çš„è¯ï¼Œå‡½æ•°ä½“ä¸­çš„ `this` å°±æŒ‡å‘å‰é¢çš„å¯¹è±¡ï¼Œæ²¡æœ‰å°±æŒ‡å‘ `window`__
#### çƒ­èº«é¢˜ 3ï¼Œä¿®æ”¹ä¸€ä¸‹çƒ­èº«é¢˜ 2
``` js
var name = 'æ—äºŒäºŒ'
var obj = {
    name: 'æ—ä¸€ä¸€',
    fn: function () {
        var name = 'å°ä¸‰',
        return function(){
             return this.name
        }
    }
}
console.log(obj.fn()())   // æ—äºŒäºŒ
var fo = obj.fn()
console.log(fo())    // æ—äºŒäºŒ
```
> çƒ­èº«3å’Œçƒ­èº«2å·®ä¸å¤šï¼Œ`obj.fn()()` ä¸­ `obj.fn()`æ‰§è¡Œå®Œåæœ‰ä¸€ä¸ªå‡½æ•°(è¿™é‡Œç§°ä¸ºå‡½æ•° `A`)è¿”å›ï¼Œæœ€åç›¸å½“äºæ‰§è¡Œå‡½æ•° `A()`ï¼Œ `A()` å‰é¢æ²¡æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `window`ï¼Œè¾“å‡ºå°±æ˜¯ `æ—äºŒäºŒ` äº†ã€‚ä¸Šé¢çš„ `fo()` å‡½æ•°åŒç†ã€‚

### äºŒã€å‡½æ•°æ²¡æœ‰ç›´æ¥è°ƒç”¨è€…
__å‡½æ•°æ²¡æœ‰ç›´æ¥è°ƒç”¨è€… `this` æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­æ˜¯windowï¼Œnodeä¸­æ˜¯ global)ã€‚å¦‚åŒ¿åå‡½æ•°ç­‰__
#### çƒ­èº«é¢˜ 1
``` js
var name = 'æ—ä¸€ä¸€';
!(function(){
   console.log(this.name)   // æ—ä¸€ä¸€
})()
```
> è‡ªæ‰§è¡Œå‡½æ•°æ²¡æœ‰ç›´æ¥çš„è°ƒç”¨è€…è¾“å‡ºçš„ `name = 'æ—ä¸€ä¸€'`ã€‚

#### çƒ­èº«é¢˜ 2
``` js
var name = 'æ—ä¸€ä¸€'
var obj = {
    name : 'äºŒäºŒ',
    callback: function(){
        console.log(this.name)
    }
}

setTimeout(obj.callback,1000)
/* è¾“å‡º
*   æ—ä¸€ä¸€
*/
```
> å‡½æ•° `setTimeout`ï¼Œ`obj.callback(è¿™åªæ˜¯ä¸€ä¸ªå¼•ç”¨åœ°å€)` ä¸­å¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨è€…ï¼Œ`this` å°±æŒ‡å‘ `window`ã€‚æ‰€ä»¥è¾“å‡ºçš„ `name` å°±æ˜¯å…¨å±€ä¸‹çš„ `æ—ä¸€ä¸€`ã€‚

### ä¸‰ã€æ„é€ å‡½æ•°ä¸­çš„ this 
__æ¥è¯»ä¸€ä¸‹è¿™å¥è¯ï¼šæ„é€ å‡½æ•°çš„ `this` æŒ‡å‘å®ä¾‹æœ¬èº«__
>å…³äºæ„é€ å‡½æ•°çš„ `this` ä¸ºä»€ä¹ˆæŒ‡å‘å®ä¾‹æ˜¯æµè§ˆå™¨æŒ‡å®šçš„ï¼Œè¯¦æƒ…çœ‹ `new` è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ [é¢è¯• | ä½ ä¸å¾—ä¸æ‡‚å¾— JS åŸå‹å’ŒåŸå‹é“¾](https://juejin.cn/post/6938590449674223624#heading-6)
#### çƒ­èº«é¢˜ 1
``` js
function Fn(){
    var n = 0
    this.name = 'æ—ä¸€ä¸€'
    this.age = 18
    this.getName = function(){
        return this.name
    }
}

Fn.prototype.getAge = function(){
    return this.age
}

Fn.x = 'æ—äºŒäºŒ'

var f = new Fn()
console.log(f.name)     // æ—ä¸€ä¸€
console.log(f.getName())     // æ—ä¸€ä¸€
console.log(f.getAge())        // 18
console.log(f.n)    // undefined
console.log(f.x)    // undefined
```
> ä¸Šé¢çš„ `Fn` ç»è¿‡ `new`åå°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ`this` å°±æŒ‡å‘å®ä¾‹ `f`ã€‚æ‰€ä»¥ä¸Šé¢çš„1ï¼Œ2è¾“å‡ºéƒ½æ˜¯`æ—ä¸€ä¸€`ã€‚`f.getAge()` æ˜¯å®ä¾‹ `f` è°ƒç”¨äº†`getAge` è¾“å‡ºå°±æ˜¯ 18ï¼Œé—®ï¼šå®ä¾‹ `f` ä¸­å¹¶æ²¡æœ‰å±æ€§ `getAge` æ˜¯æ€ä¹ˆè¾“å‡º 18çš„ï¼Œ`f.x` è¾“å‡ºåˆä¸ºä»€ä¹ˆæ˜¯ `undefined` ï¼Ÿç­”ï¼šè¿™æ˜¯åŸå‹é“¾çš„æŸ¥æ‰¾æœºåˆ¶ï¼Œå±æ€§ `x` ä¸æ˜¯åœ¨åŸå‹ `prototype` ä¸Šçš„å°±ä¸æ˜¯å®ä¾‹çš„å±æ€§ï¼Œå¯ä»¥è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç«  [é¢è¯• | ä½ ä¸å¾—ä¸æ‡‚å¾— JS åŸå‹å’ŒåŸå‹é“¾](https://juejin.cn/post/6938590449674223624)ï¼›é—®ï¼šä¸ºä»€ä¹ˆ`f.n` è¾“å‡ºçš„æ˜¯ `undefined`ã€‚å› ä¸ºå˜é‡ `n` æ˜¯æ„é€ å‡½æ•°çš„ç§æœ‰å˜é‡å’Œ `new` åˆ›å»ºçš„å®ä¾‹æ²¡æœ‰å…³ç³»ã€‚

### å››ã€ç®­å¤´å‡½æ•°
* __ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰ `this`ï¼Œç®­å¤´å‡½æ•°çš„`this`ç»§æ‰¿ä¸Šä¸‹æ–‡çš„ï¼Œé‡Œé¢çš„ `this`ä¼šæŒ‡å‘å½“å‰æœ€è¿‘çš„éç®­å¤´å‡½æ•°çš„ `this`ï¼Œæ‰¾ä¸åˆ°å°±æ˜¯ `window` (ä¸¥æ ¼æ¨¡å¼æ˜¯undefined)__
* __ç®­å¤´å‡½æ•°çš„ `this` å§‹ç»ˆæŒ‡å‘å‡½æ•°å®šä¹‰æ—¶çš„ `this`ï¼Œè€Œéæ‰§è¡Œæ—¶__
#### çƒ­èº«é¢˜ 1
``` js
var name = 'æ—ä¸€ä¸€'
var obj = {
    name: 'äºŒäºŒ',
    a: () => {
        console.log(this.name)
    }
}
obj.a()

/* è¾“å‡º
*   'æ—ä¸€ä¸€'
*/
```
> ç®­å¤´å‡½æ•°çš„ `this`ï¼Œæ‰¾ä¸åˆ°éç®­å¤´å‡½æ•°çš„ `this` å°±ç›´æ¥æŒ‡å‘ `window`ã€‚

#### çƒ­èº«é¢˜ 2
``` js
var name = 'æ—ä¸€ä¸€'
var obj = {
    name: 'äºŒäºŒ',
    fn: function() {
        return () => {
            console.log(this.name)
        }
    }
}
obj.fn()()

/* è¾“å‡º
*   'äºŒäºŒ'
*/
```
> å¾ˆæ˜æ˜¾ç®­å¤´å‡½æ•°çš„ `this` æ¥è‡ªå‡½æ•° `fn`ï¼Œå¯¹è±¡ `obj` è°ƒç”¨äº†å‡½æ•° `fn`ï¼Œæ‰€ä»¥ `fn` çš„ `this` æŒ‡å‘ `obj`ï¼Œè¾“å‡ºç»“æœå°±æ˜¯ `äºŒäºŒ`ã€‚

### äº”ã€callï¼Œapplyï¼Œbind æ”¹å˜ this çš„æŒ‡å‘
__æç¤ºï¼šæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯åŸºäº `Function` è¿™ä¸ªåŸºç±»æ¥åˆ›å»ºçš„ï¼ŒåŒæ ·æ‹¥æœ‰ `Function` åŸå‹ä¸Šé¢çš„æ–¹æ³•__
* `call`ï¼Œæ¥å—`this`çš„å¯¹è±¡ï¼Œå’Œä¸€ç»„åˆ—è¡¨ã€‚`apply` å’Œ `call` ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ `apply` æ¥å—çš„æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ã€‚`bind` åŒæ ·ä¹Ÿæ˜¯æ”¹å˜å‡½æ•°çš„ `this` æŒ‡å‘ï¼Œåªä¸è¿‡ `bind` æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ–°å‡½æ•°ä¸­å‚æ•°æ¥æºäºå‰©ä½™çš„å‚æ•°
#### çƒ­èº«é¢˜
``` js
var name = 'æ—ä¸€ä¸€'
var age = 18
function fn(){
   return this.name
}

function p(){
    return {
        age: this.age,
        arg: arguments
    }
}

let obj = {
    name: 'äºŒäºŒ',
    age: 18
}

let o = {
    name: 'ä¸‰ä¸‰'
}

fn()    // 'æ—ä¸€ä¸€'
fn.call(obj)    // 'äºŒäºŒ'
fn.call(o)  //  'ä¸‰ä¸‰'
p.call(obj, 12, 23, 45, 67) // {age: 18, arg: Arguments(4)}

fn.apply(obj)    // "äºŒäºŒ"
p.apply(obj, [1, 2, 3, 4, 5])    // {age: 18, arg: Arguments(5)}

fn.bind(obj)()  // "äºŒäºŒ"
p.bind(obj, 12, 23, 34)()   // {age: 18, arg: Arguments(3)}
```
> ä»¥ä¸Šå°±æ˜¯ `call`,  `apply`, `bind`, å…³äº `this` çš„å†…å®¹ï¼Œè¿™é‡Œä¸ä»‹ç»ä¸‰è€…çš„å†™æ³•ï¼Œå¦‚æœä»‹ç»å¯ä»¥å†™å¦ä¸€ç¯‡æ–‡ç« äº†ã€‚å¯¹è¿™ä¸‰è€…ä¸ç†Ÿæ‚‰çš„å¯ä»¥æ‰¾å…¶ä»–èµ„æ–™çœ‹çœ‹ã€‚

## æ€è€ƒé¢˜
### 1. ç¬”è¯•é¢˜ this æŒ‡å‘é—®é¢˜
``` js
var name = 'æ—ä¸€ä¸€'
var obj = {
    name: 'æ—äºŒäºŒ',
    show: function (){
        console.log(this.name)
    },
    wait: function () {
        var fn = this.show
        fn()
    }
}
obj.wait()  //  æ—ä¸€ä¸€
```
> `obj.wait()` ä¸­ï¼Œæ‰§è¡Œå‡½æ•° `wait()` å‰é¢æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `obj` è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥`this.show ==> obj.show`ã€‚å†çœ‹æ‰§è¡Œå‡½æ•° `fn()` å‰é¢æ²¡æœ‰ `'.'` ç‚¹æ“ä½œç¬¦å§ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ `this` å°±æŒ‡å‘ `window`ï¼Œè¾“å‡ºå°±æ˜¯ `æ—ä¸€ä¸€`ã€‚

### 2. å’Œé—­åŒ…æœ‰å…³çš„ this æŒ‡å‘é—®é¢˜
``` js
var n = 2 // -> 4 -> 8
var obj = {
    n: 3,    // 6
    fn: (function(n){
        n*=2
        this.n+=2    // window ä¸‹çš„ n å˜æˆ 4
        var n = 5    // è¿™ä¸€æ­¥ä¸ä¼šå†é‡æ–°å£°æ˜ï¼Œå› ä¸ºå·²ç»å‚æ•°èµ‹å€¼ï¼Œå°±ä¸ä¼šå†å£°æ˜è€Œæ˜¯ç›´æ¥èµ‹å€¼ n = 5
        console.log("window.n", window.n)
        return function (m) {
            console.log("n:", n, "m", m)    // n:5  m:3  è¿™é‡Œçš„ n å‘ä¸ŠæŸ¥æ‰¾æ˜¯ 5   // 
            this.n*=2    // fn(3): 2 * 4 =8  //  obj.fn(3): 2 * 3 = 6 
            console.log(m + (++n))    // 3 + (++5) ++n å¯¼è‡´ä¸Šçº§ä½œç”¨åŸŸçš„nå˜æˆäº†6    // 3 + (++6)
        } 
    })(n)
}

var fn = obj.fn;
fn(3)    // 9
obj.fn(3)    // 10
console.log(n, obj.n)    // 8 6
/* è¾“å‡º
* 9
* 10
* 8  6
/
```