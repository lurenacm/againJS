### 变量提升机制
### 一.什么是变量提升？
* 变量提升示例
``` js  
/* 你应该见过下面的类似代码，那你知道这是为什么*/
console.log(a)  // undefined
var a = 10
``` 
> 定义：变量提升是当栈内存作用域形成时，JS代码执行前，浏览器会将带有`var, function`关键字的变量**提前**进行声明 declare(值默认就是 undefined)，定义 defined(就是赋值操作)，这种预先处理的机制就叫做变量提升机制也叫预定义。
在变量提升阶段：带 `var` 的只声明还没有被定义，带 `function` 的已经声明和定义。所以在代码执行前有带 `var` 的就提前声明，比如这里的 `a` 就赋值成 `undefined`，在代码执行过程中遇到`创建函数的代码`浏览器会直接跳过。
 
> 不考虑变量提升阶段的 js 运行机制相关参考[JS 运行机制基础版](https://juejin.cn/post/6926729456790798343)
#### 讲解示例
``` js
var a =12
var b = a
b = 1
function sum(x, y) {
    var total = x + y
    return total
}
sum(1, 2)
```
[代码运行流程图](./img/JS代码变量提升流程图.jpg)
> 函数在调用时创建执行上下文对象还有其他关键的步骤作用域创建，this指向等，这些内容放在后面讲

<img src="https://github.com/lurenacm/againJS/blob/main/js/JS%E4%B8%89%E5%BA%A7%E5%A4%A7%E5%B1%B1%E7%B3%BB%E5%88%97/2%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E9%97%AD%E5%8C%85/img/JS%E4%BB%A3%E7%A0%81%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" width="500px" height="300px">

> 变量提升只发生在当前作用域。比如：在页面开始加载时，只有全局作用域发生变量提升，这时候的函数中存储的都是代码字符串。
 
### 二. 带 var 和不带 var 的区别
* 全局作用域中不带`var`声明变量虽然也可以但是建议带上 `var`声明变量，不带 `var` 的相当于给window对象设置一个属性罢了。
* 私有作用域(函数作用域)，带 `var` 的是私有变量。不带 `var` 的是会向上级作用域查找，如果上级作用域也没有那么就一直找到 window 为止，这个查找过程叫`作用域链`。
* 使用 `var` 申明的变量会映射到 window 下成为属性。
``` js
a = 12  // == window.a
console.log(a)  // 12
console.log(window.a) // 12

var a = b =12   // 这里的 b 也是不带 var 的。
/* 相当于*/
var a = 12;
b = 12
```
#### 思考题
1. 问下面分别输出什么？
``` js
// 1
console.log(a, b)
var a =12, b ='林一一'
function foo(){
// 2
    console.log(a, b)
// 3
    var a = b =13
    console.log(a, b)
}
foo()
console.log(a, b)

/* 输出：
    undefined undefined
    undefined "林一一"
    13 13
    12 13
*/
```
2. 问下面的结果和上面的有何不同？
``` js
console.log(a, b)
var a =12, b = '林一一'
function foo(){
    console.log(a, b)
//  var a =b =13
    console.log(a, b)
}
foo()
// 4
console.log(a, b)

/* 输出：
    undefined undefined
    12 "林一一"
    12 "林一一"
    12 "林一一
*/
``` 
#### 解答
> __上面的思考题不知道你都对了没，下面让我来解答，详情看图__
[](./img/sikaotisc.jpg)

<img src="" width="500px" height="300px">

> __思路：1处的 a, b 其实就是window下面的属性为 undefined。在函数内部由于变量提升机制 `a`带 `var` 一开始就是 undefined，`b`不带`var` 将向上级作用域查找，找到全局作用域下的`林一一`所以2处打印出来的就是 `undefined "林一一"`。随后 `a =13，window.b =13`，即原来 `b='林一一'` 变成了 `b=13`，打印出`13, 13`，最后第4处打印处`12, 13`。所以结合流程图，很明显知道答案__

3. 再来看一道，问下面答案是什么？
``` js
a = 0
function foo(){
    var a =12;
    b = '林一一'
    console.log('b' in window)
    console.log(a, b)
}

foo()
console.log(b)
console.log(a)

/* 输出
    true
    12 "林一一"
    林一一
    0
/
```
> __思路：这是比较简单的一道题，需要注意的是函数内的 b 没有带 `var`，b 会一直向上查找到 window 下，发现 window 下也没有就直接给 window 设置了一个属性 `window.b = '林一一'`，同理全局下的`a`也一样。__

### 三. 等号左边下的变量提升
* 1
* 2

#### 思考题
1. 2
2. 2


#### 解答
>


### 四. 条件判断下的变量提升
* 1
* 2

#### 思考题
1. 2
2. 2


#### 解答
>


### 五. 重名问题下的变量提升
* 1
* 2

#### 思考题
1. 2
2. 2


#### 解答
>


#### 变量提升面试题(含答案)
* 4

[变量提升面试题](http://www.srcmini.com/939.html)

### this指向
> this: 全局执行环境默认为window，函数执行环境中，如果是对象调用则为该对象，如果是普通函数调用默认为window，strict下为null。
